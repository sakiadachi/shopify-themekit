{% comment %}
  The contents of the product.liquid template can be found in /sections/product-template.liquid
{% endcomment %}

{% comment %}
{% section 'product-template' %}
{% section 'product-recommendations' %}
{% endcomment %}

{% if collection %}
  <div class="text-center return-link-wrapper page-width">
    <a href="{{ collection.url }}" class="btn btn--secondary btn--has-icon-before return-link">
      {% include 'icon-arrow-left' %}
      {{ 'products.product.back_to_collection' | t: title: collection.title }}
    </a>
  </div>
{% endif %}

<script>
  // Override default values of shop.strings for each template.
  // Alternate product templates can change values of
  // add to cart button, sold out, and unavailable states here.
  theme.productStrings = {
    addToCart: {{ 'products.product.add_to_cart' | t | json }},
    soldOut: {{ 'products.product.sold_out' | t | json }},
    unavailable: {{ 'products.product.unavailable' | t | json }}
  };
</script> 

<div id="cartModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>modal opened!</p>
  </div>
</div>


{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}
<img src="{{ featured_image | img_url: 'large' }}" alt="{{ featured_image.alt | escape }}" id="ProductPhotoImg">
{% for image in product.images %}
  <a href="{{ image.src | img_url: 'large' }}">
    <img src="{{ image.src | img_url: 'compact' }}" alt="{{ image.alt | escape }}">
  </a>
{% endfor %}

<h1>{{ product.title }}</h1>

   <form id="addToCartForm">
      <select name="id" id="productSelect">
        {% for variant in product.variants %}
          {% if variant.available %}
            <option value="{{ variant.id }}">
              {{ variant.title }} - {{ variant.price | money_with_currency }}
            </option>
          {% else %}
            <option disabled="disabled">
              {{ variant.title }} - sold out
            </option>
          {% endif %}
        {% endfor %}
      </select>
      {{ current_variant.price | money }}
      <label for="Quantity">quantity</label>
      <input type="number" id="Quantity" name="quantity" value="1" min="1">
      <button type="submit" name="add" id="addToCart">Add to cart</button>
    </form>
<div>{{ product.description }}</div>


<script type='text/javascript' >
  window.addEventListener('DOMContentLoaded', (event) => {
  event.preventDefault();
  const cartModal= document.getElementById("cartModal");
  const span= document.getElementsByClassName("close")[0];
  const form = document.getElementById("addToCartForm");
  const cartPopup = document.querySelector('cart-popup-wrapper');
  cartPopup.classList.remove("cart-popup-wrapper");

  form.addEventListener('submit', openModal);
  span.addEventListener('click', closeModal);
  function closeModal(event) {
    cartModal.style.display = "none";
  }
  function openModal(data){
    cartPopup.style.display = "block";
    console.log(data);
  }

  
  // async function addItem() {
  //     await fetch('/add/cart',
  //     {
  //       method: 'POST',
  //       headers: {'Content-Type': 'application/json'},
  //       body: JSON.stringify()
  //   })
  //   .then(reponse => response.json())
  //   .then(data => {
  //     openModal(data);
  //     closeModal();
  //   })
  //   .catch((error) => {
  //     console.error('Error: ', error);
  //   })
  //   }
  // function openModal(data){
  //   cartPopup.style.display = "block";
  //   console.log(data);
  // }
  });

//   var selectCallback = function(variant, selector){
//     if(variant && variant.available){
//         $('#add-to-cart').removeClass('disabled').removeAttr('disabled');
//         // Enable the Add to Cart button
//         $('.options .price').html('<strong>'+Shopify.formatMoney(variant.price, "{{shop.money_with_currency_format}}")+'</strong>');
//         // Show price of the currently selected variant
//     }
//     else{
//         $('#add-to-cart').addClass('disabled').attr('disabled', 'disabled');
//         // Disable the Add to Cart button
//         $('.options .price').text("Sold Out!");
//         // Swap price with a 'Sold Out' message
//     }
// };
</script>