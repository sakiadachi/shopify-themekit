{% comment %}
  The contents of the product.liquid template can be found in /sections/product-template.liquid
{% endcomment %}

{% comment %}
{% section 'product-template' %}
{% section 'product-recommendations' %}
{% endcomment %}

{% if collection %}
  <div class="text-center return-link-wrapper page-width">
    <a href="{{ collection.url }}" class="btn btn--secondary btn--has-icon-before return-link">
      {% include 'icon-arrow-left' %}
      {{ 'products.product.back_to_collection' | t: title: collection.title }}
    </a>
  </div>
{% endif %}


<div id="cartModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>modal opened!</p>
  </div>
</div>


{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}
<img src="{{ featured_image | img_url: 'large' }}" alt="{{ featured_image.alt | escape }}" id="ProductPhotoImg">
{% for image in product.images %}
  <a href="{{ image.src | img_url: 'large' }}">
    <img src="{{ image.src | img_url: 'compact' }}" alt="{{ image.alt | escape }}">
  </a>
{% endfor %}


<h1>{{ product.title }}</h1>
<form id="add-to-cart-form">
  <select name="id" id="product-select">
    {% for variant in product.variants %}
      {% if variant.available %}
        <option value="{{ variant.id }}">
          {{ variant.title }} - {{ variant.price | money_with_currency }}
        </option>
      {% else %}
        <option disabled="disabled">
          {{ variant.title }} - sold out
        </option>
      {% endif %}
    {% endfor %}
  </select>
  <label for="quantity">Quantity</label>
  <input type="number" id="Quantity" value="1" name="quantity" value="1" min="1">
  <button type="submit" name="add" id="add-to-cart" value="Add to cart">add to cart</button>
</form>
<div>{{ product.description }}</div>
<script type='text/javascript' >
    async function openModal(event){
      event.preventDefault();
      const cartPopup = document.getElementById("cartModal");
      cartPopup.style.display= "block";

      // const data = new FormData(form)
      // const response = await fetch('/cart/add.js', 
      // {
      //   method: 'POST',
      //   headers: {"Content-Type": "application/json"},
      //   body: JSON.stringify(data)
      // }
      // ).then(
      //   res => res.json()
      // ).then(data => {
      //   console.log(data)
      // })
      // .catch(error => {
      //   console.log(error, "error");
      // });
  }

  function closeModal() {
    cartModal.style.display = "none";
  }

  window.addEventListener('DOMContentLoaded', (event) => {
    const span = document.getElementsByClassName("close")[0];
    const form = document.getElementById("add-to-cart-form");
    const data = new FormData(form);

    form.addEventListener('submit', openModal);
    span.addEventListener('click', closeModal);

});

// window.addEventListener('DOMContentLoaded', (event) => {
//     event.preventDefault();
//     const cartModal= document.getElementById("cartModal");
//     const span= document.getElementsByClassName("close")[0];
//     const form = document.getElementById("add-to-cart-form");

//     form.addEventListener('submit', openModal, addItem);

//     function openModal(event){
//       event.preventDefault();
//       cartModal.style.display = "block";
//     }
//     span.addEventListener('click', closeModal);
//     function closeModal() {
//       cartModal.style.display = "none";
//     }

//     window.onclick = function(event) {
//       if (event.target == cartModal) {
//         cartModal.style.display = "none";
//       }
//     } 
//     async function addItem(form_id) {
//         await fetch('/cart/add.js',
//         {
//           method: 'POST',
//           headers: {'Content-Type': 'application/json'},
//           body: JSON.stringify()
//       })
//       .then(reponse => response.json())
//       .then(data => {
//         console.log(data);
//       })
//       .catch((error) => {
//         console.error('Error: ', error);
//       })
//     }
// });

// change font depend on availability of stock
//   var selectCallback = function(variant, selector){
//     if(variant && variant.available){
//         $('#add-to-cart').removeClass('disabled').removeAttr('disabled');
//         // Enable the Add to Cart button
//         $('.options .price').html('<strong>'+Shopify.formatMoney(variant.price, "{{shop.money_with_currency_format}}")+'</strong>');
//         // Show price of the currently selected variant
//     }
//     else{
//         $('#add-to-cart').addClass('disabled').attr('disabled', 'disabled');
//         // Disable the Add to Cart button
//         $('.options .price').text("Sold Out!");
//         // Swap price with a 'Sold Out' message
//     }
// };
</script> 