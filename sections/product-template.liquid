<div class="modal fade in hide" id="myModal">
    <div class="modal-header">
        <h3>Welcome to the page!</h3>
    </div>
    <div class="modal-body">
        <p>Modal opens when the page loaded!</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="close-btn">Close</a>
    </div>
</div>

<div id="cart-popup-wrapper" class="cart-popup">
    <div class="cart-popup__container">
        <div class="cart-popup__header">
            <span class="cart-popup-close">&times;</span>
            <h2 class="cart-popup__heading">{{ 'cart.popup.added_to_cart' |t }}</h2>
        </div>
        <div class="cart-popup-item">
            <p>{{ product.title }}</p>
            {{ product.image}}
        </div>
        <div class="cart-popup__footer">
            <a href="#" alt="back to shop">Back to shop</a>
            <a href="#" alt="check out">Check out</a>
        </div>
    </div>
</div>

<h1>{{ product.title }}</h1>

<div id="variant-inventory">
{% if product.variants.first.inventory_management == "shopify" %}
    {% if product.variants.first.inventory_quantity > 5 %}
    in stock
    {% elsif product.variants.first.inventory_quantity < 5 and product.variants.first.inventory_quantity > 0 %}
    low in stock
    {% else product.variants.first.inventory_quantity == 0 %}
    out of  stock
    {% endif%}
{% endif %}
 </div>

<form id="add-to-cart-form">
    <select name="id" id="product-select">
        {% for variant in product.variants %}
            {% if variant.available %}
                <option value="{{ variant.id }}">
                    {{ variant.title }} - {{ variant.price | money_with_currency }}
                </option>
            {% else %}
                <option disabled="disabled">
                    {{ variant.title }} - sold out
                </option>
            {% endif %}
        {% endfor %}
    </select>
    <label for="quantity">Quantity</label>
    <input type="number" id="Quantity" value="1" name="quantity" value="1" min="1">
    <button type="submit" name="add" id="add-to-cart-btn" value="Add to cart">add to cart</button>
</form>

<div>{{ product.description }}</div>

<script>
function addItemToCart(event){
    event.preventDefault();

    jQuery.ajax({
            type: 'POST',
            url: '/cart/add.js',
            data: $('#'+'add-to-cart-form').serialize(),
            dataType: 'json',
            success: function() {
                openCartPopup();
            },
    });
}

function openCartPopup(e) {
    const cartPopup = document.getElementById("cart-popup-wrapper");
    cartPopup.style.display= "block";
}
function closeCartPopup() {
    const cartPopup = document.getElementById("cart-popup-wrapper");
    cartPopup.style.display = "none";
}

window.addEventListener('DOMContentLoaded', (event) => {
    const span = document.getElementsByClassName("cart-popup-close")[0];
    const form = document.getElementById("add-to-cart-form");
    const stock = "{{ product.variants.first.inventory_quantity }}";
    const addToCartButton = document.getElementById("add-to-cart-btn");
    console.log(stock);

    if(stock > 0) {
        addToCartButton.classList.add("instock");
    } else {
        addToCartButton.classList.add("nostock");
    }

    form.addEventListener('submit', addItemToCart);
    span.addEventListener('click', closeCartPopup);
});

</script> 